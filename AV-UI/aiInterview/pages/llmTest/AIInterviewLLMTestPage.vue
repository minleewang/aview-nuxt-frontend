<template>
  <main>
    <v-container
      v-if="!start"
      align="center"
      height="100%"
      class="control-margin"
    >
      <!-- ê¸°ìˆ  ì„ íƒ ë¶€ë¶„: í•„í„°ê°€ ì—´ë¦¬ê³  ë‹«íˆëŠ” ë¶€ë¶„ -->
      <v-slide-y-transition>
        <v-row class="filter-tags-container">
          <v-col cols="12">
            <!-- ì§ë¬´ -->
            <v-row class="align-center mb-4">
              <v-col cols="1" class="filter-group-title">
                <strong>ì§ë¬´</strong>
              </v-col>
              <v-col cols="11">
                <v-chip-group v-model="selectedKeyword" column>
                  <v-chip
                    v-for="(keyword, index) in keywords"
                    :key="index"
                    :value="keyword"
                    :class="
                      selectedKeyword === keyword
                        ? 'selected-chip'
                        : 'unselected-chip'
                    "
                    class="keyword-chip"
                    clickable
                  >
                    {{ keyword }}
                  </v-chip>
                </v-chip-group>
              </v-col>
            </v-row>
            <!--Tech Skills ë¦¬ìŠ¤íŠ¸-->
            <v-row class="align-center-mb-4">
              <v-col cols="1" class="filter-group-title">
                <strong>Tech Skills</strong>
              </v-col>
              <v-col cols="11">
                <v-chip-group
                  v-model="selectedTechSkills"
                  multiple
                  class="skills-select-group"
                  column
                >
                  <v-chip
                    v-for="(skill, index) in skills"
                    :key="index"
                    :value="skill"
                    :class="
                      selectedTechSkills.includes(skill)
                        ? 'selected-chip'
                        : 'unselected-chip'
                    "
                    class="skill-chip"
                    clickable
                  >
                    {{ skill }}
                  </v-chip>
                </v-chip-group>
              </v-col>
            </v-row>
            <!--ì „ê³µ ì—¬ë¶€ ì„ íƒ-->
            <v-row class="align-center mb-4">
              <v-col cols="1" class="filter-group-title">
                <strong>ì „ê³µ ì—¬ë¶€</strong>
              </v-col>
              <v-col cols="11">
                <v-chip-group
                  v-model="selectedAcademicBackground"
                  class="academic-background-select-group"
                  column
                >
                  <v-chip
                    v-for="(major, index) in academicBackgrounds"
                    :key="index"
                    :value="major"
                    :class="
                      selectedAcademicBackground === major
                        ? 'selected-chip'
                        : 'unselected-chip'
                    "
                    class="academicBackground-chip"
                    clickable
                  >
                    {{ major }}
                  </v-chip>
                </v-chip-group>
              </v-col>
            </v-row>
            <!-- ê²½ë ¥ ì„ íƒ ë¶€ë¶„: ê¸°ìˆ ê³¼ ê°™ì€ ì—´ì— ë°°ì¹˜ -->
            <v-row class="align-center mb-4">
              <v-col cols="1" class="filter-group-title">
                <strong>ê²½ë ¥</strong>
              </v-col>
              <v-col cols="11">
                <v-chip-group
                  v-model="selectedCareer"
                  class="career-select-group"
                  column
                >
                  <v-chip
                    v-for="(career, index) in careers"
                    :key="index"
                    :value="career"
                    :class="
                      selectedCareer === career
                        ? 'selected-chip'
                        : 'unselected-chip'
                    "
                    class="career-chip"
                    clickable
                  >
                    {{ career }}
                  </v-chip>
                </v-chip-group>
              </v-col>
            </v-row>
            <!--í”„ë¡œì íŠ¸ ê²½í—˜ ìœ ë¬´ ì„ íƒ ë¶€ë¶„-->
            <v-row class="align-center mb-4">
              <v-col cols="1" class="filter-group-title">
                <strong>í”„ë¡œì íŠ¸ ê²½í—˜</strong>
              </v-col>
              <v-col cols="11">
                <v-chip-group
                  v-model="selectedProjectExperience"
                  class="projectExperience-select-group"
                >
                  <v-chip
                    v-for="(project, index) in projectExperience"
                    :key="index"
                    :value="project"
                    :class="
                      selectedProjectExperience === project
                        ? 'selected-chip'
                        : 'unselected-chip'
                    "
                    class="projectExperience-chip"
                    clickable
                  >
                    {{ project }}
                  </v-chip>
                </v-chip-group>
              </v-col>
            </v-row>
          </v-col>
        </v-row>
      </v-slide-y-transition>

      <h2>ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ? AI ëª¨ì˜ ë©´ì ‘ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</h2>
      <br />
      <v-container class="draw-line" align="start">
        <v-card-title align="center"
          ><strong>â€» ì‚¬ì „ ê³µì§€ â€»</strong></v-card-title
        ><br />
        <li class="li">
          ë³¸ ë©´ì ‘ì€ íŠ¹ì • ê¸°ì—… ë° ì§ë¬´ì— ë§ì¶”ì–´ì§„ ë©´ì ‘ì¸ì¸
          <strong>TECH-INTERVIEW</strong>ì„ì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.
        </li>

        <li class="li">
          ëª¨ì˜ë©´ì ‘ì—ëŠ” <strong>ë§ˆì´í¬, ì¹´ë©”ë¼</strong>ì˜ ì‚¬ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤.
        </li>
        <br /> </v-container
      ><br />
      <v-card-text
        ><strong
          >ì‹œì‘ì— ì•ì„œ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ì£¼ì‹­ì‹œì˜¤.</strong
        ></v-card-text
      >
      <!-- ì œì¶œ ë²„íŠ¼ -->
      <v-btn @click="startQuestion" color="primary">ì œì¶œí•˜ê¸°</v-btn>
    </v-container>
    <!-- ì‚¬ì „ì¤€ë¹„-->
  </main>
</template>

<script setup>
import { ref, onMounted } from "vue";
import { useAiInterviewStore } from "../../../aiInterview/stores/aiInterviewStore"; // Pinia store import
import { useRouter } from "vue-router";
import "@mdi/font/css/materialdesignicons.css";

// Pinia Stores
const aiInterviewStore = useAiInterviewStore();
const router = useRouter();

const start = ref(false);

//ì§ë¬´ ëª¨ìŒ
const keywords = ref([
  "Backend",
  "Frontend",
  "AppÂ·Web",
  "AI",
  "Embeddeed",
  "DevOps",
]);
const keywordMap = {
  'Backend': 1,
  'Frontend': 2,
  'Embedded': 3,
  'AI': 4,
  'DevOps': 5,
  "AppÂ·Web": 6,
};
const selectedKeyword = ref(""); // ì§ë¬´ ë‹¨ì¼ ì„ íƒ (ì¤‘ë³µì„ íƒX)


// ê¸°ìˆ  ë‹¤ì¤‘ ì„ íƒ
const skills = ref([
  "í’€ìŠ¤íƒ",
  "ë°±ì—”ë“œ/ì„œë²„ê°œë°œ",
  "í”„ë¡ íŠ¸ì—”ë“œ",
  "ì›¹ê°œë°œ",
  "Flutter",
  "Java",
  "JavaScript",
  "Python",
  "Vue.js",
  "API",
  "MYSQL",
  "AWS",
  "ReactJS",
  "ASP",
  "Angular",
  "Bootstrap",
  "Node.js",
  "jQuery",
  "PHP",
  "JSP",
  "GraphQL",
  "HTML5",
]);

const skillsMap = {
  "í’€ìŠ¤íƒ": 1,
  "ë°±ì—”ë“œ/ì„œë²„ê°œë°œ": 2,
  "í”„ë¡ íŠ¸ì—”ë“œ": 3,
  "ì›¹ê°œë°œ": 4,
  "Flutter": 5,
  'Java': 6,
  'JavaScript': 7,
  'Python': 8,
  "Vue.js": 9,
  'API': 10,
  'MYSQL': 11,
  'AWS': 12,
  'ReactJS': 13,
  'ASP': 14,
  'Angular': 15,
  'Bootstrap': 16,
  "Node.js": 17,
  'jQuery': 18,
  'PHP': 19,
  'JSP': 20,
  'GraphQL': 21,
  'HTML5': 22,
};
const selectedTechSkills = ref([]);  // âœ… ë°°ì—´ë¡œ ë°”ê¿”ì„œ ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ!

// ì „ê³µ ë‹¨ì¼ ì„ íƒ
const academicBackgrounds = ref(["ë¹„ì „ê³µì","ì „ê³µì"]);
const academicBackgroundMap = {
  'ë¹„ì „ê³µì': 0,
  'ì „ê³µì': 1,
};
const selectedAcademicBackground = ref(""); // ì „ê³µ ë‹¨ì¼ ì„ íƒ

//ê²½ë ¥ ëª¨ìŒ
const careers = ref(["ì‹ ì…", "3ë…„ ì´í•˜", "5ë…„ ì´í•˜", "10ë…„ ì´í•˜", "10ë…„ ì´ìƒ"]); // ì´ê±´ ì‚¬ìš©ìí•œí…Œ ë³´ì—¬ì§ˆ ëª©ë¡
const careerMap = {
  "ì‹ ì…": 1,
  "3ë…„ ì´í•˜": 2,
  "5ë…„ ì´í•˜": 3,
  "10ë…„ ì´í•˜": 4,
  "10ë…„ ì´ìƒ": 5,
}; // ì´ê±´ ë°±ì•¤ë“œë¡œ ë³´ë‚¼ ë°ì´í„° ëª©ë¡
const selectedCareer = ref(""); // ê²½ë ¥ ë‹¨ì¼ ì„ íƒ (ì¤‘ë³µì„ íƒX)

// í”„ë¡œì íŠ¸ ê²½í—˜
const projectExperience = ref(["ì—†ìŒ","ìˆìŒ"]);
const projectExperienceMap = {
  'ì—†ìŒ': 0,
  'ìˆìŒ': 1,
};
const selectedProjectExperience = ref(""); // í”„ë¡œì íŠ¸ ê²½í—˜ ì—¬ë¶€ ë‹¨ì¼ ì„ íƒ

onMounted(() => {
  if (process.client) {
    const userToken = localStorage.getItem("userToken");
    if (!userToken) {
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
      router.push("/account/login");
    }
  }
});

// AiInterviewQuestionPage.vueë¡œ ì´ë™
const startQuestion = async () => {
  if (
    !selectedKeyword.value ||
    !selectedCareer.value ||
    !selectedAcademicBackground.value ||
    !selectedProjectExperience.value ||
    selectedTechSkills.value.length === 0
  ) {
    alert(
      "ëª¨ë“  í•­ëª©(ì§ë¬´, ê²½ë ¥, ì „ê³µ, í”„ë¡œì íŠ¸ ê²½í—˜, ê¸°ìˆ ìŠ¤íƒ)ì„ ì„ íƒí•´ ì£¼ì„¸ìš”."
    );
    return;
  }

  console.log(`selectedTechSkills: ${selectedTechSkills.value}`)
  selectedTechSkills.value.map((skill) => console.log(`skill: ${skill}`))
  let techSkillNumberList = selectedTechSkills.value.map((skill) => skillsMap[skill])
  console.log(`techSkillNumberList: ${techSkillNumberList}`)

  const message = `ì„ íƒí•œ ì§ë¬´: ${selectedKeyword.value}
  ì„ íƒí•™ ê²½ë ¥: ${selectedCareer.value}
  ì „ê³µ ì—¬ë¶€: ${selectedAcademicBackground.value}
  í”„ë¡œì íŠ¸ ê²½í—˜: ${selectedProjectExperience.value}
  ê¸°ìˆ  ìŠ¤íƒ: ${selectedTechSkills.value.join(", ")}`;
  if (!confirm(message)) return;

  const jobstorage = {
    tech: keywordMap[selectedKeyword.value],
    exp: careerMap[selectedCareer.value],
    academic: academicBackgroundMap[selectedAcademicBackground.value],
    project: projectExperienceMap[selectedProjectExperience.value],
    skills: selectedTechSkills.value.map((skill) => skillsMap[skill])
  };
  localStorage.setItem("interviewInfo", JSON.stringify(jobstorage));
  router.push("/ai-test");
};

//ë©´ì ‘í˜ì´ì§€ì— ë“¤ì–´ì˜¤ë©´ ì¶œë ¥ë˜ëŠ” ì œëª©
useHead({
  title: `AI ëª¨ì˜ë©´ì ‘ & ì¸ì„±ë©´ì ‘ | `,
  meta: [
    {
      name: "description",
      content: "AI ëª¨ì˜ë©´ì ‘, AI ì¸ì„±ë©´ì ‘ ğŸ¯jobstcikì—ì„œ í™•ì¸í•´ë³´ì„¸ìš”.",
    },
    {
      hid: "keywords",
      name: "keywords",
      content:
        "ëª¨ì˜ë©´ì ‘, ai ëª¨ì˜ë©´ì ‘, ì¸ì„±ë©´ì ‘, ai ì¸ì„±ë©´ì ‘, ì¸ì ì„± ê²€ì‚¬ ì¤€ë¹„, ai ì¸ì , ai ë©´ì ‘, aim ëª¨ì˜ë©´ì ‘, aim ai ëª¨ì˜ë©´ì ‘, ì—ì„ ëª¨ì˜ë©´ì ‘, ì—ì„, ì• ì„, AIM, AIM Sniper",
    },
  ],
});
</script>

<style scoped>
.draw-line {
  border: 1px solid #333;
  padding: 16px;
  border-radius: 10px;
  width: 57%;
}

.li {
  margin-left: 2%;
}

.control-margin {
  margin-top: 5%;
}

.interview-container {
  margin-top: 20%;
  border: 1px solid #333;
  padding: 16px;
  border-radius: 10px;
  width: 70%;
}

/* í•„í„° ì¹© ìŠ¤íƒ€ì¼ë§ */
.filter-chip {
  margin: 5px;
  font-size: 14px;
}

.selected-chip {
  background-color: #6366f1 !important;
  color: white !important;
}

.unselected-chip {
  background-color: #e0e0e0 !important;
  color: black !important;
}

/*
.chip-selected {
  background-color: #8094f4; /* ì„ íƒëœ ì¹©ì˜ ë°°ê²½ìƒ‰ì„ ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë³€ê²½ 
  color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ í•˜ì–€ìƒ‰ìœ¼ë¡œ ë³€ê²½
} */

textarea {
  flex-grow: 1;
  border: 1px solid #ccc;
  padding: 12px;
  resize: none;
  border-radius: 10px;
  box-sizing: border-box;
  font-size: 15px;
  background-color: rgba(255, 255, 255, 1);
  color: black;
  height: 50px;
  max-height: 70px;
}

@keyframes loading-animation {
  0%,
  80%,
  100% {
    opacity: 0;
  }
  40% {
    opacity: 1;
  }
}
</style>